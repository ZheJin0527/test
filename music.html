<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>背景音乐</title>
</head>
<body>
  <audio id="bgMusic" loop autoplay>
    <source src="audio/audio/music.mp3" type="audio/mpeg" />
  </audio>

  <script>
    const bgMusic = document.getElementById('bgMusic');
    bgMusic.volume = 0.5;
    
    // 从localStorage恢复播放进度
    const savedTime = localStorage.getItem('musicCurrentTime');
    if (savedTime) {
      bgMusic.currentTime = parseFloat(savedTime);
    }
    
    // 多次尝试播放
    function tryPlay() {
      bgMusic.play().catch(() => {});
    }
    
    // 页面加载后立即尝试
    tryPlay();
    
    // 延迟再次尝试
    setTimeout(tryPlay, 100);
    setTimeout(tryPlay, 500);
    setTimeout(tryPlay, 1000);
    
    // 定期保存播放进度
    setInterval(() => {
      if (!bgMusic.paused) {
        localStorage.setItem('musicCurrentTime', bgMusic.currentTime);
      }
    }, 1000);
    
    // 用户任何交互都会触发播放
    document.addEventListener('click', tryPlay);
    document.addEventListener('keydown', tryPlay);
    document.addEventListener('touchstart', tryPlay);
    document.addEventListener('mousemove', tryPlay);
    
    // 接收父页面的播放指令
    window.addEventListener('message', function(event) {
      if (event.data === 'play') {
        tryPlay();
      }
    });
  </script>
</body>
</html>