<!DOCTYPE html>
<html lang="zh">
<head>
  <link rel="icon" type="image/png" href="images/images/logo.png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>注册 - KUNZZ HOLDINGS</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
  <section class="register-section">
  <div class="register-form">
    <button class="back-button" onclick="history.back()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      </button>
    <h2>注册账号</h2>
    <form id="register-form">
      <input type="text" name="name" placeholder="请输入您的英文姓名（例如：JOHN SMITH）" required 
          pattern="^[A-Z]+(\s+[A-Z]+)+$" 
          title="请输入至少两个英文单词，只能包含字母和空格" 
          style="text-transform: uppercase;" />

      <div class="gender-id-row">
        <div class="gender-container">
          <select name="gender" class="gender-select" required>
            <option value="">选择性别</option>
            <option value="male">男</option>
            <option value="female">女</option>
          </select>
        </div>
      <div class="id-container">
      <input type="text" name="ic_number" placeholder="身份证号码" required
        pattern="\d{12}" title="请输入12位身份证号码（不含符号）" />
        </div>
      </div>

      <input type="email" name="email" placeholder="请输入您的 Gmail" required
        pattern="[a-z0-9._%+-]+@gmail\.com$"
        title="请输入以 @gmail.com 结尾的邮箱地址（只能使用小写字母）"
        style="text-transform: lowercase;" />

      <div class="password-container">
      <input type="password" id="password" name="password" placeholder="输入密码" required
        pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_])(?!.*[\u4e00-\u9fa5]).{8,}$"
        title="密码至少包含一个大写字母、一个小写字母、一个数字和一个特殊符号，且不少于8个字符，且不能包含中文字符">
      <img src="images/images/眼睛.png" class="eye-icon" id="toggle-password" alt="显示密码">
    </div>

    <p class="password-note">密码至少包含1个大写字母、小写字母、数字、特殊符号，且不少于8位</p>

    <!-- 确认密码（新增） -->
    <div class="password-container">
      <input type="password" id="confirm_password" name="confirm_password" placeholder="确认密码" required>
      <img src="images/images/眼睛.png" class="eye-icon" id="toggle-confirm" alt="显示密码">
    </div>

      <p class="password-note">请输入相同的新密码</p>

      <div id="code-container">
      <input type="text" id="verification_code" name="application_code" placeholder="输入申请码"
        maxlength="16" pattern="[A-Za-z0-9]{4,16}" required>
      </div>
      <button type="submit">注册</button>
    </form>
  </div>
</section>

  <script src="app.js"></script>
  <script>
      document.addEventListener("DOMContentLoaded", function () {
        const togglePassword = document.getElementById("toggle-password");
        const password = document.getElementById("password");
        const toggleConfirmPassword = document.getElementById("toggle-confirm");
        const confirmPassword = document.getElementById("confirm_password");

        togglePassword.addEventListener("click", function () {
          const isVisible = password.type === "text";
          password.type = isVisible ? "password" : "text";
          this.classList.toggle("active", !isVisible);
        });

        toggleConfirmPassword.addEventListener("click", function () {
          const isVisible = confirmPassword.type === "text";
          confirmPassword.type = isVisible ? "password" : "text";
          this.classList.toggle("active", !isVisible);
        });

        // 姓名输入框处理
        const nameInput = document.querySelector('input[name="name"]');
        nameInput.addEventListener('input', function(e) {
          // 只允许字母和空格
          let value = e.target.value.replace(/[^A-Za-z\s]/g, '');
          // 转换为大写
          value = value.toUpperCase();
          // 移除多余的空格
          value = value.replace(/\s+/g, ' ');
          e.target.value = value;
        });

        // Gmail输入框处理
        const emailInput = document.querySelector('input[name="email"]');
        emailInput.addEventListener('input', function(e) {
          // 自动转换为小写
          e.target.value = e.target.value.toLowerCase();
        });

        // IC Number输入框处理（只允许数字）
        const icInput = document.querySelector('input[name="ic_number"]');
        icInput.addEventListener('input', function(e) {
          // 只允许数字
          e.target.value = e.target.value.replace(/[^0-9]/g, '');
        });
      });
  </script>
  <script>
      document.getElementById("register-form").addEventListener("submit", function (event) {
        event.preventDefault();

        const form = event.target;

        const name = form.name.value.trim();
        const gender = form.gender.value.trim();
        const icNumber = form.ic_number.value.trim();
        const email = form.email.value.trim();
        const password = form.password.value.trim();
        const confirmPassword = form.confirm_password.value.trim();
        const applicationCode = form.application_code.value.trim();

        // 验证必填字段
        if (!name || !gender || !icNumber || !email || !password || !confirmPassword || !applicationCode) {
          alert("请填写所有字段。");
          return;
        }

        // 验证姓名格式（至少两个英文单词）
        const nameRegex = /^[A-Z]+(\s+[A-Z]+)+$/;
        if (!nameRegex.test(name)) {
          alert("姓名必须至少包含两个英文单词，只能使用字母和空格，例如：JOHN SMITH");
          return;
        }

        // 验证身份证号为12位数字
        if (!/^\d{12}$/.test(icNumber)) {
          alert("身份证号码必须是12位数字");
          return;
        }

        // 验证邮箱必须是 Gmail（只允许小写）
        if (!/^[a-z0-9._%+-]+@gmail\.com$/.test(email)) {
          alert("请输入有效的 Gmail 地址（只能使用小写字母）。");
          return;
        }

        // 密码规则：大写、小写、数字、特殊符号、不少于8位、不能含中文
        const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_])(?!.*[\u4e00-\u9fa5]).{8,}$/;
        if (!passwordRegex.test(password)) {
          alert("密码必须包含大写、小写、数字和特殊字符，且不少于8位，不能包含中文。");
          return;
        }

        if (password !== confirmPassword) {
          alert("两次输入的密码不一致。");
          return;
        }

        // 验证申请码格式
        if (!/^[a-zA-Z0-9-_]{4,32}$/.test(applicationCode)) {
          alert("申请码只能包含字母、数字、连字符、下划线，长度4~32位。");
          return;
        }

        // 发出请求到后端
        fetch("register.php", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            name: name,
            gender: gender,
            ic_number: icNumber,
            email: email,
            password: password,
            application_code: applicationCode
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              alert("注册成功！");
              window.location.href = "login.html";
            } else {
              alert("注册失败：" + data.message);
            }
          })
          .catch((error) => {
            console.error("错误:", error);
            alert("注册请求失败，请稍后再试。");
          });
      });
  </script>
</body>
</html>