<!DOCTYPE html>
<html lang="zh">
<head>
  <link rel="icon" type="image/png" href="images/images/logo.png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>注册 - KUNZZ HOLDINGS</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
  <section class="register-section">
  <div class="register-form">
    <button class="back-button" onclick="history.back()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      </button>
    <h2>注册账号</h2>
    <form id="register-form">
      <input type="text" name="name" placeholder="请输入您的姓名" required />

      <div class="gender-id-row">
        <div class="gender-container">
          <select name="gender" class="gender-select" required>
            <option value="">选择性别</option>
            <option value="male">男</option>
            <option value="female">女</option>
          </select>
        </div>
      <div class="id-container">
      <input type="text" name="ic_number" placeholder="身份证号码" required
        pattern="\d{12}" title="请输入12位身份证号码（不含符号）" />
        </div>
      </div>

      <input type="email" name="email" placeholder="请输入您的 Gmail" required
        pattern="[a-zA-Z0-9._%+-]+@gmail\.com$"
        title="请输入以 @gmail.com 结尾的邮箱地址" />

      <div class="password-container">
      <input type="password" id="password" name="password" placeholder="输入密码" required
        pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_])(?!.*[\u4e00-\u9fa5]).{8,}$"
        title="密码至少包含一个大写字母、一个小写字母、一个数字和一个特殊符号，且不少于8个字符，且不能包含中文字符">
      <img src="images/images/眼睛.png" class="eye-icon" id="toggle-password" alt="显示密码">
    </div>

    <p class="password-note">密码至少包含1个大写字母、小写字母、数字、特殊符号，且不少于8位</p>

    <!-- 确认密码（新增） -->
    <div class="password-container">
      <input type="password" id="confirm_password" name="confirm_password" placeholder="确认密码" required>
      <img src="images/images/眼睛.png" class="eye-icon" id="toggle-confirm" alt="显示密码">
    </div>

      <p class="password-note">请输入相同的新密码</p>

      <div id="code-container">
      <input type="text" id="verification_code" name="application_code" placeholder="输入申请码"
        maxlength="16" pattern="[A-Za-z0-9]{4,16}" required>
      </div>
      <button type="submit">注册</button>
    </form>
  </div>
</section>

  <script src="app.js"></script>
  <script>
document.addEventListener("DOMContentLoaded", function () {
  const togglePassword = document.getElementById("toggle-password");
  const password = document.getElementById("password");
  const toggleConfirmPassword = document.getElementById("toggle-confirm");
  const confirmPassword = document.getElementById("confirm_password");

  togglePassword.addEventListener("click", function () {
    const isVisible = password.type === "text";
    password.type = isVisible ? "password" : "text";
    this.classList.toggle("active", !isVisible);
  });

  toggleConfirmPassword.addEventListener("click", function () {
    const isVisible = confirmPassword.type === "text";
    confirmPassword.type = isVisible ? "password" : "text";
    this.classList.toggle("active", !isVisible);
  });
});
</script>
  <script>
document.getElementById("register-form").addEventListener("submit", function (event) {
  event.preventDefault();

  const form = event.target;

  const email = form.email.value.trim();
  const password = form.password.value.trim();
  const confirmPassword = form.confirm_password.value.trim();
  const applicationCode = form.application_code.value.trim();

  // 验证邮箱必须是 Gmail
  if (!/^[a-zA-Z0-9._%+-]+@gmail\.com$/.test(email)) {
    alert("请输入有效的 Gmail 地址。");
    return;
  }

  // 验证密码强度（至少8位，包含字母和数字）
  if (!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_])(?!.*[\u4e00-\u9fa5]).{8,}$/.test(password)) {
    alert("密码必须至少包含一个大写字母、小写字母、数字和特殊符号，且不少于8位，不能包含中文字符。");
    return;
  }

  // 验证密码不能包含中文
  if (/[\u4e00-\u9fa5]/.test(password)) {
    alert("密码不能包含中文字符。");
    return;
  }

  // 验证两次密码一致
  if (password !== confirmPassword) {
    alert("两次输入的密码不一致。");
    return;
  }

  // 验证申请码格式
  if (!/^[a-zA-Z0-9-_]{4,32}$/.test(applicationCode)) {
    alert("申请码只能包含字母、数字、连字符和下划线，长度4~32位。");
    return;
  }

  // 从申请码解析账号类型，例如：admin-xxxx、dep1-xxxx、user-xxxx
  let accountType = "user"; // 默认类型
  if (applicationCode.startsWith("admin-")) {
    accountType = "admin";
  } else if (applicationCode.startsWith("dep1-")) {
    accountType = "department1";
  } else if (applicationCode.startsWith("dep2-")) {
    accountType = "department2";
  } else {
    accountType = "user"; // 可根据你定义的规则继续扩展
  }

  // 发送到后端进行注册
  fetch("register.php", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      email: email,
      password: password,
      application_code: applicationCode,
      account_type: accountType // 新增字段
    }),
  })
    .then((response) => response.text())
    .then((data) => {
      if (data === "success") {
        alert("注册成功！");
        window.location.href = "login.html";
      } else {
        alert("注册失败：" + data);
      }
    })
    .catch((error) => {
      console.error("错误:", error);
      alert("注册请求失败，请稍后再试。");
    });
});
</script>


</body>
</html>