<?php
session_start();

// Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁôªÂΩïÔºàÊ†πÊçÆ‰Ω†ÁöÑÁôªÂΩïÁ≥ªÁªüË∞ÉÊï¥Ôºâ
if (!isset($_SESSION['user_id'])) {
    header("Location: login.html");
    exit();
}

// Â§ÑÁêÜÊ∑ªÂä†Âπ¥‰ªΩ
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['add_year'])) {
    $newYear = trim($_POST['new_year']);
    $title = trim($_POST['new_title']);
    $description1 = trim($_POST['new_description1']);
    $description2 = trim($_POST['new_description2']);
    
    if (!empty($newYear) && !empty($title) && is_numeric($newYear)) {
        if (!isset($config[$newYear])) {
            $newData = [
                'title' => $title,
                'description1' => $description1,
                'description2' => $description2,
                'image' => '',
                'created' => date('Y-m-d H:i:s')
            ];
            
            if (addTimelineYear($newYear, $newData)) {
                $success = "Âπ¥‰ªΩ {$newYear} Ê∑ªÂä†ÊàêÂäüÔºÅ";
                // ÈáçÊñ∞ËØªÂèñÈÖçÁΩÆ
                $config = [];
                if (file_exists('timeline_config.json')) {
                    $config = json_decode(file_get_contents('timeline_config.json'), true) ?: [];
                }
                // ÂêàÂπ∂ÈªòËÆ§Êï∞ÊçÆ
                foreach ($defaultTimeline as $year => $data) {
                    if (!isset($config[$year])) {
                        $config[$year] = $data;
                    } else {
                        $config[$year] = array_merge($data, $config[$year]);
                    }
                }
                // ÊåâÂπ¥‰ªΩÊéíÂ∫è
                uksort($config, function($a, $b) {
                    return (int)$a - (int)$b;
                });
            } else {
                $error = "Ê∑ªÂä†Âπ¥‰ªΩÂ§±Ë¥•ÔºÅ";
            }
        } else {
            $error = "Âπ¥‰ªΩ {$newYear} Â∑≤Â≠òÂú®ÔºÅ";
        }
    } else {
        $error = "ËØ∑Â°´ÂÜôÊúâÊïàÁöÑÂπ¥‰ªΩÂíåÊ†áÈ¢òÔºÅ";
    }
}

// Â§ÑÁêÜÂà†Èô§Âπ¥‰ªΩ
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['delete_year'])) {
    $deleteYear = $_POST['delete_year'];
    
    // Èò≤Ê≠¢Âà†Èô§ÈªòËÆ§Âπ¥‰ªΩ
    $protectedYears = ['2022', '2023', '2025'];
    if (in_array($deleteYear, $protectedYears)) {
        $error = "Êó†Ê≥ïÂà†Èô§ÈªòËÆ§Âπ¥‰ªΩ {$deleteYear}ÔºÅ";
    } else {
        if (deleteTimelineYear($deleteYear)) {
            $success = "Âπ¥‰ªΩ {$deleteYear} Âà†Èô§ÊàêÂäüÔºÅ";
            // ÈáçÊñ∞ËØªÂèñÈÖçÁΩÆ
            $config = [];
            if (file_exists('timeline_config.json')) {
                $config = json_decode(file_get_contents('timeline_config.json'), true) ?: [];
            }
            // ÂêàÂπ∂ÈªòËÆ§Êï∞ÊçÆ
            foreach ($defaultTimeline as $year => $data) {
                if (!isset($config[$year])) {
                    $config[$year] = $data;
                } else {
                    $config[$year] = array_merge($data, $config[$year]);
                }
            }
            // ÊåâÂπ¥‰ªΩÊéíÂ∫è
            uksort($config, function($a, $b) {
                return (int)$a - (int)$b;
            });
        } else {
            $error = "Âà†Èô§Âπ¥‰ªΩÂ§±Ë¥•ÔºÅ";
        }
    }
}

// Â§ÑÁêÜÊñá‰ª∂‰∏ä‰º†ÂíåÊñáÊ°à‰øÆÊîπ
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $uploadDir = 'images/images/';
    $configFile = 'timeline_config.json';
    
    // Á°Æ‰øù‰∏ä‰º†ÁõÆÂΩïÂ≠òÂú®
    if (!file_exists($uploadDir)) {
        mkdir($uploadDir, 0777, true);
    }
    
    // Â§ÑÁêÜÁÖßÁâá‰∏ä‰º†
    if (isset($_FILES['timeline_image']) && $_FILES['timeline_image']['error'] === UPLOAD_ERR_OK) {
        $file = $_FILES['timeline_image'];
        $year = $_POST['year'];
        $fileExtension = strtolower(pathinfo($file['name'], PATHINFO_EXTENSION));
        
        // ÂÖÅËÆ∏ÁöÑÊñá‰ª∂Á±ªÂûã
        $allowedImage = ['jpg', 'jpeg', 'png', 'webp'];
        
        if (in_array($fileExtension, $allowedImage)) {
            // ÁîüÊàêÊñ∞Êñá‰ª∂Âêç
            $newFileName = $year . 'ÂèëÂ±ï.' . $fileExtension;
            $targetPath = $uploadDir . $newFileName;
            
            if (move_uploaded_file($file['tmp_name'], $targetPath)) {
                // Êõ¥Êñ∞ÈÖçÁΩÆÊñá‰ª∂
                $config = [];
                if (file_exists($configFile)) {
                    $config = json_decode(file_get_contents($configFile), true) ?: [];
                }
                
                if (!isset($config[$year])) {
                    $config[$year] = [];
                }
                
                $config[$year]['image'] = $targetPath;
                $config[$year]['updated'] = date('Y-m-d H:i:s');
                
                file_put_contents($configFile, json_encode($config, JSON_PRETTY_PRINT));
                $success = "ÁÖßÁâá‰∏ä‰º†ÊàêÂäüÔºÅ";
            } else {
                $error = "ÁÖßÁâá‰∏ä‰º†Â§±Ë¥•ÔºÅ";
            }
        } else {
            $error = "‰∏çÊîØÊåÅÁöÑÊñá‰ª∂Á±ªÂûãÔºÅ‰ªÖÊîØÊåÅ JPG, PNG, WebP Ê†ºÂºè";
        }
    }
    
    // Â§ÑÁêÜÊñáÊ°àÊõ¥Êñ∞
    if (isset($_POST['update_content'])) {
        $year = $_POST['year'];
        $title = $_POST['title'];
        $description1 = $_POST['description1'];
        $description2 = $_POST['description2'];
        
        // Êõ¥Êñ∞ÈÖçÁΩÆÊñá‰ª∂
        $config = [];
        if (file_exists($configFile)) {
            $config = json_decode(file_get_contents($configFile), true) ?: [];
        }
        
        if (!isset($config[$year])) {
            $config[$year] = [];
        }
        
        $config[$year]['title'] = $title;
        $config[$year]['description1'] = $description1;
        $config[$year]['description2'] = $description2;
        $config[$year]['updated'] = date('Y-m-d H:i:s');
        
        file_put_contents($configFile, json_encode($config, JSON_PRETTY_PRINT));
        $success = "ÊñáÊ°àÊõ¥Êñ∞ÊàêÂäüÔºÅ";
    }
}

// ËØªÂèñÂΩìÂâçÈÖçÁΩÆ
$config = [];
if (file_exists('timeline_config.json')) {
    $config = json_decode(file_get_contents('timeline_config.json'), true) ?: [];
}

// ÈªòËÆ§Êó∂Èó¥Á∫øÊï∞ÊçÆ
$defaultTimeline = [
    '2022' => [
        'title' => '‰∏ÄÂë≥ÂÖ•È≠ÇÔºåÊÉÖÊöñ‰∫∫Èó¥ ‚ú®',
        'description1' => 'Âú®‰∫∫ÁîüÁöÑÈ§êÊ°å‰∏äÔºåÊÄªÊúâ‰∏Ä‰∫õÂë≥ÈÅìËÉΩÂ§üÂî§ÈÜíËÆ∞ÂøÜÔºå‰∏Ä‰∫õÁû¨Èó¥ËÉΩÂ§üËß¶Âä®ÂøÉÂº¶„ÄÇTokyo Japanese CuisineÔºåËøô‰∏™ÂêçÂ≠ó‰∏ç‰ªÖ‰ªÖ‰ª£Ë°®ÁùÄÁ≤æËá¥ÁöÑÊó•ÂºèÊñôÁêÜÔºåÊõ¥ÊâøËΩΩÁùÄ‰∏Ä‰ªΩÂØπÁæéÈ£ü‰∏éÊúçÂä°ÁöÑÊ∑±ÊÉÖÊâøËØ∫„ÄÇ',
        'description2' => 'Êàë‰ª¨ÁöÑÊïÖ‰∫ãÔºåÂßã‰∫é 2022 Âπ¥ÔºåÈÇ£‰∏ÄÂπ¥ÔºåÊàë‰ª¨ÊÄÄÊè£ÁùÄ‰∏Ä‰∏™ÁÆÄÂçïËÄåÂèàÂÆèÂ§ßÁöÑÊ¢¶ÊÉ≥Ôºö‰ª•ÁÉ≠ÊÉÖÁöÑÊúçÂä°ÔºåËÆ©ÊØè‰∏Ä‰ΩçËµ∞ËøõTokyo Japanese CuisineÁöÑÈ°æÂÆ¢ÔºåÈÉΩËÉΩ‰∫´Âèó‰∏ÄÂú∫ÊÑâÊÇ¶ËÄåÈöæÂøòÁöÑÁî®È§ê‰ΩìÈ™å„ÄÇ',
        'image' => 'images/images/2022ÂèëÂ±ï.jpg'
    ],
    '2023' => [
        'title' => 'Áî®ÂøÉÈì∏Â∞±ÔºåÊ¢¶ÊÉ≥ÁîüÈïø üå±',
        'description1' => 'Kunzz Holdings Sdn BhdÔºå‰∏Ä‰∏™ÊâøËΩΩÁùÄÊ¢¶ÊÉ≥‰∏éÊ∏©Â∫¶ÁöÑÂêçÂ≠óÔºåÁäπÂ¶Ç‰∏ÄÊ£µÂú®Â∏åÊúõÊ≤ÉÂúü‰∏äÊâéÊ†πÁöÑÂπºËãóÔºå‰∫é 2023 Âπ¥Á†¥ÂúüËÄåÂá∫„ÄÇÊàë‰ª¨‰∏ç‰ªÖ‰ªÖÊòØ‰∏ÄÂÆ∂ËÇ©Ë¥ü‰ΩøÂëΩÁöÑÊéßËÇ°ÂÖ¨Âè∏ÔºåÊõ¥ÊòØÊóó‰∏ãÊØè‰∏ÄÂÆ∂Â≠êÂÖ¨Âè∏ÊúÄÂùöÂÆûÁöÑÂêéÁõæ‰∏éÊúÄÁúüÊåöÁöÑÂºïË∑Ø‰∫∫„ÄÇ',
        'description2' => 'Êàë‰ª¨Ê∑±‰ø°ÔºåÂîØÊúâÁî®ÂøÉÁÆ°ÁêÜÔºåÂÄæÂäõÊé®ÂπøÔºåÊâçËÉΩËÆ©ÊØè‰∏Ä‰∏™Áã¨ÁâπÁöÑÂàõÊÑè‰∏éÊ¢¶ÊÉ≥ÔºåÂú®Êó∂‰ª£ÁöÑËàûÂè∞‰∏äÁªΩÊîæÂá∫ÊúÄÁíÄÁí®ÁöÑÂÖâËäíÔºåÊàê‰∏∫ÊîπÂèò‰∏ñÁïåÁöÑÂäõÈáè„ÄÇ',
        'image' => 'images/images/2023ÁöÑÂèëÂ±ï.jpg'
    ],
    '2025' => [
        'title' => 'ËßÑËåÉÁÆ°ÁêÜÔºåÁ®≥ÂÅ•ÂâçË°å üöÄ',
        'description1' => '2025Âπ¥ÔºåÊàë‰ª¨ËøéÊù•‰∫ÜËßÑËåÉÂåñÁÆ°ÁêÜÁöÑÊñ∞Á∫™ÂÖÉ„ÄÇÈÄöËøáÂª∫Á´ãÂÆåÂñÑÁöÑÁÆ°ÁêÜ‰ΩìÁ≥ªÂíåÊ†áÂáÜÂåñÊµÅÁ®ãÔºåÊàë‰ª¨‰∏çÊñ≠ÊèêÂçáËøêËê•ÊïàÁéáÔºåÁ°Æ‰øùÊØè‰∏Ä‰∏™È°πÁõÆÈÉΩËÉΩÂú®ËßÑËåÉÁöÑËΩ®ÈÅì‰∏äÁ®≥ÂÅ•ÂèëÂ±ï„ÄÇ',
        'description2' => 'Êàë‰ª¨ÂßãÁªàÂùöÊåÅ‰ª•ÂÆ¢Êà∑‰∏∫‰∏≠ÂøÉÔºå‰ª•Ë¥®Èáè‰∏∫ÁîüÂëΩÔºåÁî®‰∏ì‰∏öÁöÑÊÄÅÂ∫¶ÂíåÂàõÊñ∞ÁöÑÊÄùÁª¥Ôºå‰∏∫ÂÆ¢Êà∑ÂàõÈÄ†Êõ¥Â§ß‰ª∑ÂÄºÔºå‰∏∫Ë°å‰∏öÊ†ëÁ´ãÊñ∞ÁöÑÊ†áÊùÜ„ÄÇ',
        'image' => 'images/images/2025ÁöÑÂèëÂ±ï.jpg'
    ]
];

// ÂêàÂπ∂ÈÖçÁΩÆ
foreach ($defaultTimeline as $year => $data) {
    if (!isset($config[$year])) {
        $config[$year] = $data;
    } else {
        // ‰øùÁïôÁé∞ÊúâÈÖçÁΩÆÔºå‰ΩÜË°•ÂÖÖÁº∫Â§±ÁöÑÂ≠óÊÆµ
        $config[$year] = array_merge($data, $config[$year]);
    }
}
?>

<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂèëÂ±ïÂéÜÂè≤ÁÆ°ÁêÜ - KUNZZ HOLDINGS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #ffffffff 0%, #f3ebe0ff 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            border: 3px solid #FF5C00;
        }
        
        .header {
            background: linear-gradient(135deg, #FF5C00 0%, #ff7a33 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .breadcrumb {
            padding: 20px 40px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        
        .breadcrumb a {
            color: #FF5C00;
            text-decoration: none;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        
        .content {
            padding: 40px;
        }
        
        .timeline-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 5px solid #FF5C00;
        }
        
        .timeline-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .year-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .year-tab {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .year-tab.active {
            background: #FF5C00;
        }
        
        .year-tab:hover {
            transform: translateY(-2px);
        }
        
        .timeline-content {
            display: none;
        }
        
        .timeline-content.active {
            display: block;
        }
        
        .upload-form {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-group label {
            font-weight: 600;
            color: #555;
        }
        
        .file-input {
            border: 2px dashed #FF5C00;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: #fff9f5;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .file-input:hover {
            border-color: #e54a00;
            background: #fff5f0;
        }
        
        .file-input input {
            display: none;
        }
        
        .file-input-text {
            color: #FF5C00;
            font-size: 1.1em;
            font-weight: 500;
        }
        
        .current-file {
            margin-top: 15px;
            padding: 15px;
            background: #e8f4f8;
            border-radius: 8px;
            border-left: 4px solid #FF5C00;
        }
        
        .current-file strong {
            color: #155724;
        }
        
        .preview-container {
            margin-top: 20px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .preview-image {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
        }
        
        .content-form {
            background: white;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #dee2e6;
            margin-top: 20px;
        }
        
        .content-form h3 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #FF5C00;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #FF5C00;
        }
        
        .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 1em;
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }
        
        .form-textarea:focus {
            outline: none;
            border-color: #FF5C00;
        }
        
        .btn {
            background: linear-gradient(135deg, #FF5C00 0%, #ff7a33 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 92, 0, 0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
            margin-left: 10px;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        .back-btn {
            display: inline-block;
            background: #6c757d;
            color: white;
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 6px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            
            .timeline-section {
                padding: 20px;
            }
            
            .year-tabs {
                flex-wrap: wrap;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .btn-secondary {
                margin-left: 0;
            }
        }

        .year-management {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            margin: 30px 0;
            border: 2px solid #e9ecef;
        }

        .management-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #FF5C00;
        }

        .management-section:last-child {
            margin-bottom: 0;
        }

        .management-section h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.3em;
        }

        .add-year-form, .delete-year-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #c82333 0%, #bd2130 100%);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .year-management {
                padding: 20px;
            }
            
            .management-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ÂèëÂ±ïÂéÜÂè≤ÁÆ°ÁêÜ</h1>
            <p>ÁÆ°ÁêÜÂÖ≥‰∫éÊàë‰ª¨È°µÈù¢ÁöÑÊó∂Èó¥Á∫øÁÖßÁâáÂíåÊñáÊ°àÂÜÖÂÆπ</p>
        </div>
        
        <div class="breadcrumb">
            <a href="dashboard.php">‰ª™Ë°®Êùø</a> > 
            <a href="media_manager.php">Â™í‰ΩìÁÆ°ÁêÜ</a> > 
            <span>ÂèëÂ±ïÂéÜÂè≤ÁÆ°ÁêÜ</span>
        </div>
        
        <div class="content">
            <a href="media_manager.php" class="back-btn">‚Üê ËøîÂõûÂ™í‰ΩìÁÆ°ÁêÜ</a>
            
            <?php if (isset($success)): ?>
                <div class="alert alert-success"><?php echo $success; ?></div>
            <?php endif; ?>
            
            <?php if (isset($error)): ?>
                <div class="alert alert-error"><?php echo $error; ?></div>
            <?php endif; ?>
            
            <div class="timeline-section">
                <h2>üìÖ Êó∂Èó¥Á∫øÂÜÖÂÆπÁÆ°ÁêÜ</h2>
                
                <!-- Âπ¥‰ªΩÈÄâÊã©Ê†áÁ≠æ -->
                <div class="year-tabs">
                    <?php 
                    $isFirst = true;
                    foreach ($config as $year => $data): 
                    ?>
                    <button class="year-tab <?php echo $isFirst ? 'active' : ''; ?>" onclick="showYear('<?php echo $year; ?>')"><?php echo $year; ?>Âπ¥</button>
                    <?php 
                    $isFirst = false;
                    endforeach; 
                    ?>
                </div>

                <!-- Âπ¥‰ªΩÁÆ°ÁêÜÂå∫Âüü -->
                <div class="year-management">
                    <div class="management-section">
                        <h3>‚ûï Ê∑ªÂä†Êñ∞Âπ¥‰ªΩ</h3>
                        <form method="post" class="add-year-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Âπ¥‰ªΩ</label>
                                    <input type="number" name="new_year" class="form-input" placeholder="Â¶Ç: 2024" min="1900" max="2100" required>
                                </div>
                                <div class="form-group">
                                    <label>Ê†áÈ¢ò</label>
                                    <input type="text" name="new_title" class="form-input" placeholder="ËæìÂÖ•Âπ¥‰ªΩÊ†áÈ¢ò..." required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Á¨¨‰∏ÄÊÆµÊèèËø∞</label>
                                <textarea name="new_description1" class="form-textarea" placeholder="ËæìÂÖ•Á¨¨‰∏ÄÊÆµÊèèËø∞..." required></textarea>
                            </div>
                            <div class="form-group">
                                <label>Á¨¨‰∫åÊÆµÊèèËø∞</label>
                                <textarea name="new_description2" class="form-textarea" placeholder="ËæìÂÖ•Á¨¨‰∫åÊÆµÊèèËø∞..." required></textarea>
                            </div>
                            <button type="submit" name="add_year" class="btn">Ê∑ªÂä†Âπ¥‰ªΩ</button>
                        </form>
                    </div>
                    
                    <div class="management-section">
                        <h3>üóëÔ∏è Âà†Èô§Âπ¥‰ªΩ</h3>
                        <form method="post" class="delete-year-form">
                            <div class="form-group">
                                <label>ÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑÂπ¥‰ªΩ</label>
                                <select name="delete_year" class="form-input" required>
                                    <option value="">ÈÄâÊã©Âπ¥‰ªΩ...</option>
                                    <?php foreach ($config as $year => $data): ?>
                                        <?php if (!in_array($year, ['2022', '2023', '2025'])): // Èò≤Ê≠¢Âà†Èô§ÈªòËÆ§Âπ¥‰ªΩ ?>
                                        <option value="<?php echo $year; ?>"><?php echo $year; ?>Âπ¥</option>
                                        <?php endif; ?>
                                    <?php endforeach; ?>
                                </select>
                            </div>
                            <button type="submit" name="delete_year" class="btn btn-danger" onclick="return confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Âπ¥‰ªΩÂêóÔºüÊ≠§Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄÔºÅ')">Âà†Èô§Âπ¥‰ªΩ</button>
                        </form>
                    </div>
                </div>
                
                <?php foreach ($config as $year => $data): ?>
                <div class="timeline-content <?php echo $year == '2022' ? 'active' : ''; ?>" id="content-<?php echo $year; ?>">
                    <!-- ÁÖßÁâá‰∏ä‰º†Ë°®Âçï -->
                    <form method="post" enctype="multipart/form-data" class="upload-form">
                        <input type="hidden" name="year" value="<?php echo $year; ?>">
                        
                        <div class="form-group">
                            <label>‰∏ä‰º† <?php echo $year; ?> Âπ¥ÁÖßÁâá</label>
                            <div class="file-input" onclick="document.getElementById('image-<?php echo $year; ?>').click()">
                                <input type="file" id="image-<?php echo $year; ?>" name="timeline_image" accept="image/*">
                                <div class="file-input-text">
                                    ÁÇπÂáªÈÄâÊã©ÁÖßÁâáÊàñÊãñÊãΩÂà∞Ê≠§Â§Ñ<br>
                                    <small>ÊîØÊåÅ JPG, PNG, WebP Ê†ºÂºèÔºåÂª∫ËÆÆÂ∞∫ÂØ∏ 800x600</small>
                                </div>
                            </div>
                            
                            <?php if (isset($data['image']) && file_exists($data['image'])): ?>
                                <div class="current-file">
                                    <strong>ÂΩìÂâçÁÖßÁâá:</strong> <?php echo basename($data['image']); ?><br>
                                    <small>Êõ¥Êñ∞Êó∂Èó¥: <?php echo $data['updated'] ?? 'Êú™Áü•'; ?></small>
                                    
                                    <div class="preview-container">
                                        <img class="preview-image" src="<?php echo $data['image']; ?>?v=<?php echo time(); ?>" alt="<?php echo $year; ?>Âπ¥ÁÖßÁâá">
                                    </div>
                                </div>
                            <?php endif; ?>
                        </div>
                        
                        <button type="submit" class="btn">‰∏ä‰º†ÁÖßÁâá</button>
                    </form>
                    
                    <!-- ÊñáÊ°àÁºñËæëË°®Âçï -->
                    <div class="content-form">
                        <h3>üìù ÁºñËæë <?php echo $year; ?> Âπ¥ÊñáÊ°àÂÜÖÂÆπ</h3>
                        <form method="post">
                            <input type="hidden" name="year" value="<?php echo $year; ?>">
                            <input type="hidden" name="update_content" value="1">
                            
                            <div class="form-group">
                                <label>Ê†áÈ¢ò</label>
                                <input type="text" name="title" class="form-input" 
                                       value="<?php echo htmlspecialchars($data['title'] ?? ''); ?>" 
                                       placeholder="ËæìÂÖ•Ê†áÈ¢ò...">
                            </div>
                            
                            <div class="form-group">
                                <label>Á¨¨‰∏ÄÊÆµÊèèËø∞</label>
                                <textarea name="description1" class="form-textarea" 
                                          placeholder="ËæìÂÖ•Á¨¨‰∏ÄÊÆµÊèèËø∞..."><?php echo htmlspecialchars($data['description1'] ?? ''); ?></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>Á¨¨‰∫åÊÆµÊèèËø∞</label>
                                <textarea name="description2" class="form-textarea" 
                                          placeholder="ËæìÂÖ•Á¨¨‰∫åÊÆµÊèèËø∞..."><?php echo htmlspecialchars($data['description2'] ?? ''); ?></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn">‰øùÂ≠òÊñáÊ°à</button>
                            </div>
                        </form>
                    </div>
                </div>
                <?php endforeach; ?>
            </div>
        </div>
    </div>
    
    <script>
        // Âπ¥‰ªΩÂàáÊç¢ÂäüËÉΩ - ÊîØÊåÅÂä®ÊÄÅÂπ¥‰ªΩ
        function showYear(year) {
            // ÈöêËóèÊâÄÊúâÂÜÖÂÆπ
            document.querySelectorAll('.timeline-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ÁßªÈô§ÊâÄÊúâÊ†áÁ≠æÁöÑactiveÁä∂ÊÄÅ
            document.querySelectorAll('.year-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ÊòæÁ§∫ÈÄâ‰∏≠Âπ¥‰ªΩÁöÑÂÜÖÂÆπ
            const targetContent = document.getElementById('content-' + year);
            if (targetContent) {
                targetContent.classList.add('active');
            }
            
            // ÊøÄÊ¥ªÈÄâ‰∏≠ÁöÑÊ†áÁ≠æ
            const targetTab = document.querySelector(`[onclick="showYear('${year}')"]`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
        }

        // Âä®ÊÄÅÁîüÊàêÂÜÖÂÆπÂå∫ÂüüÔºàÂú®È°µÈù¢Âä†ËΩΩÊó∂Ë∞ÉÁî®Ôºâ
        document.addEventListener('DOMContentLoaded', function() {
            // Â¶ÇÊûúÊ≤°ÊúâÊâæÂà∞ÂØπÂ∫îÁöÑÂÜÖÂÆπÂå∫ÂüüÔºåÂä®ÊÄÅÂàõÂª∫
            <?php foreach ($config as $year => $data): ?>
            if (!document.getElementById('content-<?php echo $year; ?>')) {
                // ËøôÈáåÂèØ‰ª•Ê∑ªÂä†Âä®ÊÄÅÂàõÂª∫ÂÜÖÂÆπÂå∫ÂüüÁöÑÈÄªËæë
                console.log('Creating content area for year: <?php echo $year; ?>');
            }
            <?php endforeach; ?>
        });
        
        // ÈáçÁΩÆË°®Âçï
        function resetForm(year) {
            const form = document.querySelector(`#content-${year} .content-form form`);
            if (confirm('Á°ÆÂÆöË¶ÅÈáçÁΩÆË°®ÂçïÂêóÔºüÊâÄÊúâÊú™‰øùÂ≠òÁöÑÊõ¥ÊîπÂ∞Ü‰∏¢Â§±„ÄÇ')) {
                form.reset();
            }
        }
        
        // Êñá‰ª∂ÊãñÊãΩÂíåÈÄâÊã©ÂäüËÉΩ
        document.querySelectorAll('.file-input').forEach(input => {
            input.addEventListener('dragover', (e) => {
                e.preventDefault();
                input.style.borderColor = '#e54a00';
                input.style.background = '#fff5f0';
            });
            
            input.addEventListener('dragleave', (e) => {
                e.preventDefault();
                input.style.borderColor = '#FF5C00';
                input.style.background = '#fff9f5';
            });
            
            input.addEventListener('drop', (e) => {
                e.preventDefault();
                const files = e.dataTransfer.files;
                const fileInput = input.querySelector('input[type="file"]');
                fileInput.files = files;
                
                input.style.borderColor = '#FF5C00';
                input.style.background = '#fff9f5';
                
                if (files.length > 0) {
                    const textDiv = input.querySelector('.file-input-text');
                    textDiv.innerHTML = `Â∑≤ÈÄâÊã©: ${files[0].name}`;
                }
            });
        });
        
        document.querySelectorAll('input[type="file"]').forEach(input => {
            input.addEventListener('change', function() {
                const textDiv = this.parentElement.querySelector('.file-input-text');
                if (this.files.length > 0) {
                    textDiv.innerHTML = `Â∑≤ÈÄâÊã©: ${this.files[0].name}`;
                }
            });
        });
        
        // Ë°®ÂçïÈ™åËØÅ
        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', function(e) {
                const requiredFields = form.querySelectorAll('[required]');
                let isValid = true;
                
                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        isValid = false;
                        field.style.borderColor = '#dc3545';
                    } else {
                        field.style.borderColor = '#e9ecef';
                    }
                });
                
                if (!isValid) {
                    e.preventDefault();
                    alert('ËØ∑Â°´ÂÜôÊâÄÊúâÂøÖÂ°´Â≠óÊÆµ');
                }
            });
        });
    </script>
</body>
</html>